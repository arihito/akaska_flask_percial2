{% extends "base.j2" %}
{% block content %}
    <div class="mb-4 rounded key_visual fade-in fade-delay-2"></div>
    <div class="row">
        <div class="col-md-9">
            {% if top1 %}
                <div class="card rounded shadow recommend fade-in fade-delay-1">
                    <div class="row g-0 h-100">
                        <div class="col-md-8">
                            <div class="card-body p-4">
                                <h3 class="pb-4 mb-4 fst-italic border-bottom">
                                    <i class="fa fa-calendar-o me-2"></i>今週のオススメ記事
                                </h3>
                                <div class="category_tag mb-2">
                                    {% for category in top1.memo.categories %}
                                        <span class="badge rounded-pill" style="background-color: {{ category.color }}">{{ category.name }}</span>
                                    {% endfor %}
                                </div>
                                {% if top1.memo.image_filename %}
                                    <div class="mt-4 mb-3 d-md-none"><img style="height:240px;object-fit:cover;" src="{{ url_for('static', filename='images/memo/' ~ top1.memo.image_filename) }}" class="img-fluid rounded change-mode" width="" height="" alt="記事画像"></div>
                                {% endif %}
                                <h2 class="card-title display-6 link-body-emphasis mb-1"><a class="text-body-secondary text-decoration-none" href="{{ url_for('public.detail', memo_id=top1.memo.id) }}">{{ top1.memo.title }}</a></h2>
                                <p class="mb-2 text-body-secondary">
                                    <i class="fa fa-calendar-o"></i> {{ top1.memo.created_at.strftime("%Y年%m月%d日") }} by {{ top1.memo.user.username }}<i class="fa fa-gratipay ms-3" style="color:#603"></i>{{ top1.like_count }}いいね
                                </p>
                                <p class="card-text">{{ top1.memo.content | truncate(200, False, '...') }}</p>
                            </div>
                        </div>
                        <div class="col-md-4 d-none d-md-block">
                            <div class="h-100">
                                <a href="{{ url_for('public.detail', memo_id=top1.memo.id) }}"><img class="w-100 h-100 rounded-end change-mode" src="{{ url_for('static', filename='images/memo/' ~ top1.memo.image_filename) }}" width="100" height="" alt="記事画像" style="object-fit: cover"></a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
            <div class="row mt-3">
                {% for row in memos %}
                    {% set memo = row.memo %}
                    {% set like_count = row.like_count %}
                    <div class="col-md-6 d-flex fade-in fade-delay-{{ loop.index }}">
                        <div class="text-body-secondary row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm position-relative h-90 w-100">
                            <div class="memo-img-wrap">
                                <a href="{{ url_for('public.detail', memo_id=row.memo.id) }}"
                                    class="text-decoration-none">
                                    <img class="change-mode" src="{{ url_for('static', filename='images/memo/' ~ memo.image_filename) }}" alt="記事画像" width="" height="">
                                </a>
                            </div>
                            <div class="col pt-2 px-4 pb-3 d-flex flex-column position-static">
                                <div class="category_tag mb-2">
                                    {% for category in memo.categories %}
                                        <span class="badge rounded-pill" style="background-color: {{ category.color }}">{{ category.name }}</span>
                                    {% endfor %}
                                </div>
                                <h3 class="mb-0"><a class="text-body-secondary text-decoration-none" href="{{ url_for('public.detail', memo_id=row.memo.id) }}">{{ memo.title }}</a></h3>
                                <div class="mb-1 text-body-secondary">
                                    <i class="fa fa-calendar-o"></i> {{ memo.created_at.strftime("%Y年%m月%d日") }}
                                    by <strong class="d-inline-block mb-2">{{ memo.user.username }}</strong>
                                    {% if current_user.is_authenticated and memo.user_id != current_user.id %}
                                        <span class="like-area" data-memo-id="{{ memo.id }}">
                                            {% if memo.id in favorite_memo_ids %}
                                                <button class="btn-like active ms-1" data-action="remove">
                                                    <i class="fa fa-heart" style="color:#e06"></i><span class="like-count">{{ like_count }}いいね</span>
                                                </button>
                                            {% else %}
                                                <button class="btn-like ms-1" data-action="add">
                                                    <i class="fa fa-heart-o" style="color:#666"></i><span class="like-count">{{ like_count }}いいね</span>
                                                </button>
                                            {% endif %}
                                        </span>
                                    {% elif current_user.is_authenticated and memo.user_id == current_user.id %}
                                        <small class="ms-2"><i class="fa fa-heart" style="color:#603"></i>{{ like_count }}いいね (<i class="fa fa-address-card me-1"></i>自身の記事)</small>
                                    {% else %}
                                        <a class="text-body-secondary ms-2" href="{{ url_for('auth.login') }}"><i class="fa fa-heart" style="color:#603"></i>{{ like_count }}いいね (まずはログイン!)</a>
                                    {% endif %}
                                </div>
                                <p class="card-text mb-auto">{{ memo.content | truncate(150, False, '...') }}</p>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <nav aria-label="Page navigation" class="mt-3 mb-5 my-md-5 fade-in fade-delay-3">
                <ul class="pagination justify-content-center pagination-secondary">
                    <li class="page-item {% if page == 1 %}disabled{% endif %}">
                        <a class="page-link d-flex align-items-center justify-content-center h-100"
                            href="?page={{ page - 1 }}"
                            aria-label="Previous"><i class="fa fa-arrow-left"></i></a>
                    </li>
                    {% for p in range(1, total_pages + 1) %}
                        <li class="page-item {% if p == page %}active{% endif %}">
                            <a class="page-link" href="?page={{ p }}">{{ p }}</a>
                        </li>
                    {% endfor %}
                    <li class="page-item {% if page == total_pages %}disabled{% endif %}">
                        <a class="page-link d-flex align-items-center justify-content-center h-100"
                            href="?page={{ page + 1 }}"
                            aria-label="Next"><i class="fa fa-arrow-right"></i></a>
                    </li>
                </ul>
            </nav>
        </div>
        {% include "public/aside.j2" %}
    </div>
{% endblock content %}
