{% extends "fixed/base.j2" %}
{% block article_body %}
  <p>ãƒ¢ãƒ€ãƒ³ãªãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—å½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒ ã€flaskã®æ¨™æº–é–¢æ•°ã¨ã—ã¦åŒæ¢±ã€‚</p>
  <ul class="list-group my-3">
    <li class="list-group-item"><i class="fa fa-circle"></i> Dropzone.js ã‚’ç”¨ã„ãŸãƒ•ãƒ­ãƒ³ãƒˆå´ UI</li>
    <li class="list-group-item"><i class="fa fa-circle"></i> Flask å´ã§ãƒ•ã‚¡ã‚¤ãƒ«å—ä¿¡</li>
    <li class="list-group-item"><i class="fa fa-circle"></i> ä»»æ„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ä¿å­˜</li>
    <li class="list-group-item"><i class="fa fa-circle"></i> æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ Dropzone ã«è¿”ã™</li>
  </ul>
  <pre class="file-tag" data-tag="console"><code>mkdir -p file_drugdrop/static/images file_drugdrop/templates &amp;&amp; \
t file_drugdrop/app.py file_drugdrop/tempmlates/upload.j2 &amp;&amp; \
cd file_drugdrop

[ file_drugdrop ]
   â”œâ”€ ğŸ“static
   â”‚     â””â”€ ğŸ“image
   â”œâ”€ ğŸ“templates
   â”‚     â””â”€ ğŸ“„upload.j2
   â””â”€ ğŸ“„app.py</code></pre>
  <p>Dropzoneã‹ã‚‰ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’å—ã‘å–ã£ãŸå¾Œã€ã‚µãƒ¼ãƒãƒ¼ã«ä¿å­˜ã™ã‚‹ã€‚</p>
  <pre class="file-tag" data-tag="app.py"><code>import os
from flask import Flask, request, render_template, jsonify

app = Flask(__name__)
app.config[&#x27;UPLOAD_FOLDER&#x27;] = &#x27;static/uploads&#x27;

@app.route(&quot;/&quot;)
def index():
    return render_template(&quot;upload.j2&quot;)

@app.route(&quot;/upload&quot;, methods=[&quot;POST&quot;])
def upload():
    if &quot;file&quot; not in request.files:
        return jsonify({&quot;error&quot;: &quot;No file part&quot;}), 400

    file = request.files[&quot;file&quot;]

    if file.filename == &quot;&quot;:
        return jsonify({&quot;error&quot;: &quot;ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã§ãã¾ã›ã‚“ã§ã—ãŸ&quot;}), 400

    # ä¿å­˜å…ˆãƒ‘ã‚¹ä½œæˆ
    save_path = os.path.join(app.config[&#x27;UPLOAD_FOLDER&#x27;], file.filename)
    file.save(save_path)

    return jsonify({&quot;success&quot;: True, &quot;filename&quot;: file.filename})

if __name__ == &quot;__main__&quot;:
    app.run(debug=True)</code></pre>
  <pre class="file-tag" data-tag="templates/upload.j2"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;ja&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Dropzone Upload&lt;/title&gt;
    &lt;!-- Dropzone CDN --&gt;
    &lt;link rel=&quot;stylesheet&quot;
          href=&quot;https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/basic.min.css&quot; /&gt;
    &lt;link rel=&quot;stylesheet&quot;
          href=&quot;https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.css&quot; /&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.js&quot;&gt;&lt;/script&gt;
    &lt;style&gt;
        .dz-message {
            font-size: 20px;
            color: #666;
        }
        .dropzone {
            border: 2px dashed #777;
            border-radius: 10px;
            background: #f9f9f9;
        }
    &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;

&lt;h2&gt;Drag &amp; Drop File Upload&lt;/h2&gt;

&lt;!-- Dropzone Form --&gt;
&lt;form action=&quot;/upload&quot; class=&quot;dropzone&quot; id=&quot;myDropzone&quot;&gt;&lt;/form&gt;

&lt;script&gt;
    Dropzone.options.myDropzone = {
        paramName: &quot;file&quot;,
        maxFilesize: 5, // MB
        acceptedFiles: &quot;.png,.jpg,.jpeg,.gif&quot;,

        init: function() {
            this.on(&quot;success&quot;, function(file, response) {
                console.log(&quot;Uploaded:&quot;, response);
            });

            this.on(&quot;error&quot;, function(file, message) {
                console.error(&quot;Error:&quot;, message);
            });
        }
    };
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
  <h3 class="display-6 mt-5 mb-2"><i class="fa fa-sort-amount-asc"></i> ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ•ã‚§ãƒ¼ãƒ‰è¡¨ç¤º</h3>
  <pre class="file-tag" data-tag="app.py"><code>import os
from flask import Flask, request, render_template, jsonify
from pathlib import Path

app = Flask(__name__)
app.config[&#x27;UPLOAD_FOLDER&#x27;] = &#x27;static/images&#x27;

IMAGE_DIR = Path(&quot;static/images&quot;)
ALLOWED_SUFFIXES = {&quot;.jpg&quot;, &quot;.png&quot;}

def get_images():
    return sorted(
      (
          p.relative_to(&quot;static&quot;).as_posix()
          for p in IMAGE_DIR.iterdir()
          if p.is_file() and p.suffix.lower() in ALLOWED_SUFFIXES
      ),
      reverse=True
    )

@app.route(&quot;/&quot;)
def index():
    return render_template(&quot;upload.j2&quot;, images=get_images())

@app.route(&quot;/upload&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])
def upload():

    if request.method == &quot;POST&quot;:
      if &quot;file&quot; not in request.files:
          return jsonify({&quot;error&quot;: &quot;No file part&quot;}), 400

      file = request.files[&quot;file&quot;]

      if file.filename == &quot;&quot;:
          return jsonify({&quot;error&quot;: &quot;ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã§ãã¾ã›ã‚“ã§ã—ãŸ&quot;}), 400

      # ä¿å­˜å…ˆãƒ‘ã‚¹ä½œæˆ
      save_path = os.path.join(app.config[&#x27;UPLOAD_FOLDER&#x27;], file.filename)
      file.save(save_path)

      return jsonify({&quot;success&quot;: True, &quot;filename&quot;: file.filename})
    return render_template(&quot;upload.j2&quot;, images=get_images())

if __name__ == &quot;__main__&quot;:
    app.run(debug=True)
</code></pre>
  <pre class="file-tag" data-tag="templates/upload.j2"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;ja&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Dropzone Upload&lt;/title&gt;
    &lt;meta name=&quot;description&quot; content=&quot;&quot;&gt;
    &lt;meta name=&quot;keywords&quot; content=&quot;&quot;&gt;
    &lt;!-- Dropzone CDN --&gt;
    &lt;link rel=&quot;stylesheet&quot;
          href=&quot;https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/basic.min.css&quot; /&gt;
    &lt;link rel=&quot;stylesheet&quot;
          href=&quot;https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.css&quot; /&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.js&quot;&gt;&lt;/script&gt;
    &lt;style&gt;
        .dz-message {
            font-size: 20px;
            color: #666;
        }
        .dropzone {
            border: 2px dashed #777;
            border-radius: 10px;
            background: #f9f9f9;
        }
        .fade-img {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .fade-img.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h2&gt;Drag &amp; Drop File Upload&lt;/h2&gt;
    &lt;!-- Dropzone Form --&gt;
    &lt;form action=&quot;/upload&quot; class=&quot;dropzone&quot; id=&quot;myDropzone&quot;&gt;
    &lt;/form&gt;
    &lt;div class=&quot;image-list&quot;&gt;
      &#37;&#123; for img in images &#37;&#125;
        &lt;img src=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=img) &#125;&#125;&quot;
             class=&quot;fade-img&quot;
             width=&quot;120&quot;
             height=&quot;&quot;
             alt=&quot;&quot;&gt;
      &#37;&#123; endfor &#37;&#125;
    &lt;/div&gt;
    &lt;script&gt;
Dropzone.options.myDropzone = {
    paramName: &quot;file&quot;,
    maxFilesize: 5,
    acceptedFiles: &quot;.png,.jpg,.jpeg,.gif&quot;,

    init: function () {
        this.on(&quot;success&quot;, function (file, response) {

            // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒãƒ‘ã‚¹ã‚’ä½œæˆ
            const imgPath = &quot;/static/images/&quot; + file.name;

            // img è¦ç´ ä½œæˆ
            const img = document.createElement(&quot;img&quot;);
            img.src = imgPath;
            img.className = &quot;fade-img&quot;;
            img.width = 120;

            // ç”»åƒãƒªã‚¹ãƒˆã«è¿½åŠ 
            const container = document.querySelector(&quot;.image-list&quot;);
            container.prepend(img);

            // æ¬¡ãƒ•ãƒ¬ãƒ¼ãƒ ã§ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
            requestAnimationFrame(() =&gt; {
                img.classList.add(&quot;is-visible&quot;);
            });
        });

        this.on(&quot;error&quot;, function (file, message) {
            console.error(&quot;Error:&quot;, message);
        });
    }
};

// åˆæœŸè¡¨ç¤ºåˆ†ã®ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
document.addEventListener(&quot;DOMContentLoaded&quot;, () =&gt; {
    document.querySelectorAll(&quot;.fade-img&quot;).forEach((img, index) =&gt; {
        setTimeout(() =&gt; {
            img.classList.add(&quot;is-visible&quot;);
        }, index * 100);
    });
});
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<h3 class="display-6 mt-5 mb-2"><i class="fa fa-cogs"></i> æ‹¡å¼µæ¡ˆ</h3>
<p>å¿…è¦ã§ã‚ã‚Œã°ä»¥ä¸‹ã‚‚ä½œæˆã§ãã¾ã™ã€‚</p>
<ul class="list-group my-3">
<li class="list-group-item"><i class="fa fa-circle"></i> ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã«ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆï¼ˆPillowï¼‰</li>
<li class="list-group-item"><i class="fa fa-circle"></i> S3 ã¸ã®è‡ªå‹•è»¢é€ï¼ˆç½²å URL ã§ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ç›´æ¥ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰</li>
<li class="list-group-item"><i class="fa fa-circle"></i> å¤šãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®é€²æ—ç®¡ç†</li>
<li class="list-group-item"><i class="fa fa-circle"></i> Flask-WTF + Dropzone ã®çµ±åˆãƒ•ã‚©ãƒ¼ãƒ </li>
<li class="list-group-item"><i class="fa fa-circle"></i> éåŒæœŸå‡¦ç†ï¼ˆCeleryï¼‰ã¨çµ„ã¿åˆã‚ã›ãŸå¤§å®¹é‡ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</li>
</ul>
{% endblock %}
